---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import FormattedDate from '../../components/FormattedDate.astro';
import { i18n } from '../../i18n';

const lang = 'zh';
const posts = (await getCollection('blog'))
	.filter((p) => p.data.lang === lang)
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const postsByYear = posts.reduce(
	(acc, post) => {
		const year = post.data.pubDate.getFullYear();
		if (!acc[year]) acc[year] = [];
		acc[year].push(post);
		return acc;
	},
	{} as Record<number, typeof posts>,
);

const years = Object.keys(postsByYear)
	.map(Number)
	.sort((a, b) => b - a);
const t = i18n[lang].pages;
---

<BaseLayout lang={lang} title={t.archives} description={t.archives}>
	<div class="space-y-12">
		<h1 class="text-3xl font-bold">{t.archives}</h1>

		{
			years.map((year) => (
				<section>
					<h2 class="text-2xl font-bold mb-6 text-zinc-400 border-b border-zinc-200 dark:border-zinc-800 pb-2">
						{year}
					</h2>
					<ul class="space-y-4">
						{postsByYear[year].map((post) => (
							<li class="flex flex-col sm:flex-row gap-2 sm:items-baseline group">
								<span class="text-zinc-500 dark:text-zinc-500 text-sm font-mono w-32 shrink-0">
									<FormattedDate date={post.data.pubDate} />
								</span>
								<a
									href={`/zh/blog/${post.data.slug}/`}
									class="text-lg font-medium group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors"
								>
									{post.data.title}
								</a>
							</li>
						))}
					</ul>
				</section>
			))
		}
	</div>
</BaseLayout>
